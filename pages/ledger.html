<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Ledger - Pesewa.com</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/tables.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/svg+xml" href="../assets/images/logo.svg">
</head>
<body class="page-ledger">
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="../index.html">
                    <img src="../assets/images/logo.svg" alt="Pesewa Logo" class="logo">
                    <span class="brand-name">Pesewa.com</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="./dashboard/lender-dashboard.html">Dashboard</a></li>
                <li><a href="./lending.html">Lend</a></li>
                <li><a href="./borrowing.html">Borrow</a></li>
                <li><a href="./groups.html">Groups</a></li>
                <li><a href="./subscriptions.html">Subscription</a></li>
                <li class="active"><a href="./ledger.html">Ledger</a></li>
            </ul>
            <div class="nav-actions">
                <div class="user-dropdown">
                    <button class="btn btn-outline" id="userMenuBtn">My Account</button>
                    <div class="dropdown-content">
                        <a href="./dashboard/borrower-dashboard.html">Borrower Dashboard</a>
                        <a href="./dashboard/lender-dashboard.html">Lender Dashboard</a>
                        <a href="./dashboard/admin-dashboard.html">Admin Dashboard</a>
                        <hr>
                        <button id="logoutBtn" class="btn-logout">Logout</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-container">
        <div class="page-header">
            <h1>Loan Ledger Management</h1>
            <p>Track all your lending and borrowing activities. Update repayment status and manage your financial records.</p>
            <div class="header-actions">
                <button class="btn btn-primary" id="newLedgerBtn">+ Create New Ledger</button>
                <button class="btn btn-secondary" id="exportLedgerBtn">Export to CSV</button>
            </div>
        </div>

        <div class="ledger-controls">
            <div class="filter-controls">
                <select id="ledgerFilter" class="form-select">
                    <option value="all">All Ledgers</option>
                    <option value="active">Active Loans</option>
                    <option value="overdue">Overdue</option>
                    <option value="completed">Completed</option>
                    <option value="defaulted">Defaulted</option>
                </select>
                <select id="timeFilter" class="form-select">
                    <option value="all">All Time</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                </select>
                <input type="text" id="searchLedger" placeholder="Search borrower or ID..." class="form-control">
                <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
            </div>
        </div>

        <div class="ledger-stats">
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-details">
                    <h3>Total Lent</h3>
                    <p class="stat-value">‚Çµ25,400</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-details">
                    <h3>Interest Earned</h3>
                    <p class="stat-value">‚Çµ2,540</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-details">
                    <h3>Overdue</h3>
                    <p class="stat-value">‚Çµ3,000</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-details">
                    <h3>Repayment Rate</h3>
                    <p class="stat-value">96%</p>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2>Loan Ledgers</h2>
                <span class="table-count">Showing 8 of 45 entries</span>
            </div>
            <div class="table-responsive">
                <table class="data-table ledger-table">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th>Ledger ID</th>
                            <th>Borrower</th>
                            <th>Category</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>Total Due</th>
                            <th>Date Issued</th>
                            <th>Due Date</th>
                            <th>Days Left</th>
                            <th>Penalty</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="ledger-row active">
                            <td><input type="checkbox" class="row-checkbox"></td>
                            <td>#LG-001</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small">J</div>
                                    <div class="user-info">
                                        <strong>John Borrower</strong>
                                        <small>+233 24 123 4567</small>
                                    </div>
                                </div>
                            </td>
                            <td>üöå Transport</td>
                            <td>‚Çµ1,200</td>
                            <td>‚Çµ120</td>
                            <td>‚Çµ1,320</td>
                            <td>2024-03-20</td>
                            <td>2024-03-27</td>
                            <td><span class="days-left positive">3</span></td>
                            <td>‚Çµ0</td>
                            <td><span class="status active">Active</span></td>
                            <td>
                                <button class="btn-action view-ledger" title="View Details">üëÅÔ∏è</button>
                                <button class="btn-action update-payment" title="Update Payment">üí∞</button>
                                <button class="btn-action rate-borrower" title="Rate Borrower">‚≠ê</button>
                            </td>
                        </tr>
                        <tr class="ledger-row warning">
                            <td><input type="checkbox" class="row-checkbox"></td>
                            <td>#LG-002</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small">M</div>
                                    <div class="user-info">
                                        <strong>Mary Borrower</strong>
                                        <small>+233 24 234 5678</small>
                                    </div>
                                </div>
                            </td>
                            <td>üíä Medicine</td>
                            <td>‚Çµ5,000</td>
                            <td>‚Çµ500</td>
                            <td>‚Çµ5,500</td>
                            <td>2024-03-18</td>
                            <td>2024-03-25</td>
                            <td><span class="days-left negative">-1</span></td>
                            <td>‚Çµ275</td>
                            <td><span class="status warning">Overdue</span></td>
                            <td>
                                <button class="btn-action view-ledger" title="View Details">üëÅÔ∏è</button>
                                <button class="btn-action update-payment" title="Update Payment">üí∞</button>
                                <button class="btn-action send-reminder" title="Send Reminder">üì¢</button>
                            </td>
                        </tr>
                        <tr class="ledger-row completed">
                            <td><input type="checkbox" class="row-checkbox"></td>
                            <td>#LG-003</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small">D</div>
                                    <div class="user-info">
                                        <strong>David Borrower</strong>
                                        <small>+233 24 345 6789</small>
                                    </div>
                                </div>
                            </td>
                            <td>üç≤ Food</td>
                            <td>‚Çµ800</td>
                            <td>‚Çµ80</td>
                            <td>‚Çµ880</td>
                            <td>2024-03-10</td>
                            <td>2024-03-17</td>
                            <td><span class="days-left neutral">0</span></td>
                            <td>‚Çµ0</td>
                            <td><span class="status completed">Paid</span></td>
                            <td>
                                <button class="btn-action view-ledger" title="View Details">üëÅÔ∏è</button>
                                <button class="btn-action view-history" title="Payment History">üìä</button>
                                <button class="btn-action reissue-loan" title="Reissue Loan">üîÑ</button>
                            </td>
                        </tr>
                        <tr class="ledger-row alert">
                            <td><input type="checkbox" class="row-checkbox"></td>
                            <td>#LG-004</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small">A</div>
                                    <div class="user-info">
                                        <strong>Anna Borrower</strong>
                                        <small>+233 24 456 7890</small>
                                    </div>
                                </div>
                            </td>
                            <td>üí° Electricity</td>
                            <td>‚Çµ3,000</td>
                            <td>‚Çµ300</td>
                            <td>‚Çµ3,300</td>
                            <td>2024-02-01</td>
                            <td>2024-02-08</td>
                            <td><span class="days-left negative">-45</span></td>
                            <td>‚Çµ6,750</td>
                            <td><span class="status alert">Defaulted</span></td>
                            <td>
                                <button class="btn-action view-ledger" title="View Details">üëÅÔ∏è</button>
                                <button class="btn-action blacklist" title="Blacklist">‚ö´</button>
                                <button class="btn-action contact-collector" title="Contact Collector">üïµÔ∏è</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <div class="pagination">
                    <button class="btn-pagination prev" disabled>Previous</button>
                    <span class="page-numbers">
                        <button class="page-btn active">1</button>
                        <button class="page-btn">2</button>
                        <button class="page-btn">3</button>
                        <span>...</span>
                        <button class="page-btn">5</button>
                    </span>
                    <button class="btn-pagination next">Next</button>
                </div>
                <div class="table-actions">
                    <button class="btn btn-secondary" id="bulkUpdateBtn">Bulk Update</button>
                    <button class="btn btn-alert" id="bulkExportBtn">Export Selected</button>
                </div>
            </div>
        </div>

        <!-- Ledger Detail Modal -->
        <div id="ledgerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Ledger Details: #LG-001</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h3>Borrower Information</h3>
                            <div class="detail-item">
                                <span>Full Name:</span>
                                <strong>John Borrower</strong>
                            </div>
                            <div class="detail-item">
                                <span>Contact:</span>
                                <strong>+233 24 123 4567</strong>
                            </div>
                            <div class="detail-item">
                                <span>Location:</span>
                                <strong>Accra, Ghana</strong>
                            </div>
                            <div class="detail-item">
                                <span>National ID:</span>
                                <strong>GHA-123456789</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Loan Details</h3>
                            <div class="detail-item">
                                <span>Category:</span>
                                <strong>üöå Transport</strong>
                            </div>
                            <div class="detail-item">
                                <span>Principal:</span>
                                <strong>‚Çµ1,200</strong>
                            </div>
                            <div class="detail-item">
                                <span>Interest (10%):</span>
                                <strong>‚Çµ120</strong>
                            </div>
                            <div class="detail-item">
                                <span>Total Due:</span>
                                <strong>‚Çµ1,320</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Guarantors</h3>
                            <div class="detail-item">
                                <span>Guarantor 1:</span>
                                <strong>James Smith (+233 24 111 2222)</strong>
                            </div>
                            <div class="detail-item">
                                <span>Guarantor 2:</span>
                                <strong>Sarah Johnson (+233 24 333 4444)</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Timeline</h3>
                            <div class="detail-item">
                                <span>Issued Date:</span>
                                <strong>2024-03-20</strong>
                            </div>
                            <div class="detail-item">
                                <span>Due Date:</span>
                                <strong>2024-03-27</strong>
                            </div>
                            <div class="detail-item">
                                <span>Days Remaining:</span>
                                <strong class="positive">3 days</strong>
                            </div>
                        </div>

                        <div class="detail-section full-width">
                            <h3>Payment History</h3>
                            <div class="payment-history">
                                <div class="payment-item">
                                    <span class="payment-date">2024-03-21</span>
                                    <span class="payment-amount">‚Çµ200</span>
                                    <span class="payment-method">M-Pesa</span>
                                    <span class="payment-status completed">Verified</span>
                                </div>
                                <div class="payment-item">
                                    <span class="payment-date">2024-03-22</span>
                                    <span class="payment-amount">‚Çµ300</span>
                                    <span class="payment-method">Bank Transfer</span>
                                    <span class="payment-status pending">Pending</span>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section full-width">
                            <h3>Update Payment</h3>
                            <form class="payment-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="paymentAmount">Amount (‚Çµ)</label>
                                        <input type="number" id="paymentAmount" class="form-control" value="200" min="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentDate">Date</label>
                                        <input type="date" id="paymentDate" class="form-control" value="2024-03-23">
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentMethod">Method</label>
                                        <select id="paymentMethod" class="form-control">
                                            <option>M-Pesa</option>
                                            <option>Bank Transfer</option>
                                            <option>Cash</option>
                                            <option>Mobile Money</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="paymentNotes">Notes</label>
                                    <textarea id="paymentNotes" class="form-control" rows="2" placeholder="Optional notes"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Record Payment</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Pesewa.com</h3>
                <p>Emergency micro-lending in trusted circles across Africa.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="./about.html">About Us</a></li>
                    <li><a href="./contact.html">Contact</a></li>
                    <li><a href="./qa.html">Q&A</a></li>
                    <li><a href="./debt-collectors.html">Debt Collectors</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Disclaimer</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Pesewa.com. All rights reserved.</p>
        </div>
    </footer>

    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/ledger.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Select all checkbox
            const selectAll = document.getElementById('selectAll');
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');
            
            selectAll.addEventListener('change', function() {
                rowCheckboxes.forEach(cb => cb.checked = this.checked);
            });

            // Modal functionality
            const modal = document.getElementById('ledgerModal');
            const closeBtn = document.querySelector('.close-modal');
            const viewButtons = document.querySelectorAll('.view-ledger');

            viewButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    modal.style.display = 'block';
                });
            });

            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Payment form
            document.querySelector('.payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Payment recorded successfully!');
                this.reset();
            });

            // Filter functionality
            document.getElementById('applyFilters').addEventListener('click', function() {
                const filter = document.getElementById('ledgerFilter').value;
                const rows = document.querySelectorAll('.ledger-row');
                
                rows.forEach(row => {
                    if (filter === 'all' || row.classList.contains(filter)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    window.location.href = '../index.html';
                }
            });

            // User dropdown
            const userMenuBtn = document.getElementById('userMenuBtn');
            const dropdownContent = document.querySelector('.dropdown-content');

            userMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
            });

            window.addEventListener('click', function() {
                dropdownContent.style.display = 'none';
            });
        });
    </script>
</body>
</html>