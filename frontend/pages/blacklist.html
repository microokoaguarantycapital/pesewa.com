<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blacklist - Pesewa.com</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/tables.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/svg+xml" href="../assets/images/logo.svg">
</head>
<body class="page-blacklist">
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="../index.html">
                    <img src="../assets/images/logo.svg" alt="Pesewa Logo" class="logo">
                    <span class="brand-name">Pesewa.com</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="./dashboard/borrower-dashboard.html">Dashboard</a></li>
                <li><a href="./lending.html">Lend</a></li>
                <li><a href="./borrowing.html">Borrow</a></li>
                <li><a href="./groups.html">Groups</a></li>
                <li class="active"><a href="./blacklist.html">Blacklist</a></li>
                <li><a href="./debt-collectors.html">Collectors</a></li>
            </ul>
            <div class="nav-actions">
                <div class="user-dropdown">
                    <button class="btn btn-outline" id="userMenuBtn">My Account</button>
                    <div class="dropdown-content">
                        <a href="./dashboard/borrower-dashboard.html">Borrower Dashboard</a>
                        <a href="./dashboard/lender-dashboard.html">Lender Dashboard</a>
                        <a href="./dashboard/admin-dashboard.html">Admin Dashboard</a>
                        <hr>
                        <button id="logoutBtn" class="btn-logout">Logout</button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-container">
        <div class="page-header">
            <h1>Platform Blacklist</h1>
            <p>View and manage blacklisted borrowers. Only platform administrators can remove entries after full repayment.</p>
            <div class="header-stats">
                <div class="stat-badge alert">
                    <span class="stat-label">Total Blacklisted</span>
                    <span class="stat-value">45</span>
                </div>
                <div class="stat-badge warning">
                    <span class="stat-label">Pending Clearance</span>
                    <span class="stat-value">12</span>
                </div>
                <div class="stat-badge">
                    <span class="stat-label">This Month</span>
                    <span class="stat-value">3</span>
                </div>
            </div>
        </div>

        <div class="blacklist-controls">
            <div class="controls-grid">
                <div class="search-box">
                    <input type="text" id="searchBlacklist" placeholder="Search by name, ID, or amount..." class="form-control">
                    <button class="btn-search">üîç</button>
                </div>
                <div class="filter-controls">
                    <select id="countryFilter" class="form-select">
                        <option value="">All Countries</option>
                        <option value="gh">Ghana</option>
                        <option value="ke">Kenya</option>
                        <option value="ng">Nigeria</option>
                        <option value="tz">Tanzania</option>
                        <option value="ug">Uganda</option>
                        <option value="za">South Africa</option>
                        <option value="rw">Rwanda</option>
                        <option value="bi">Burundi</option>
                        <option value="so">Somalia</option>
                        <option value="ss">South Sudan</option>
                        <option value="et">Ethiopia</option>
                        <option value="cd">Congo</option>
                    </select>
                    <select id="statusFilter" class="form-select">
                        <option value="">All Statuses</option>
                        <option value="active">Active Blacklist</option>
                        <option value="pending">Pending Clearance</option>
                        <option value="appealed">Appealed</option>
                        <option value="cleared">Recently Cleared</option>
                    </select>
                    <select id="daysFilter" class="form-select">
                        <option value="">All Periods</option>
                        <option value="30">Last 30 Days</option>
                        <option value="60">Last 60 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="180">Last 180 Days</option>
                    </select>
                    <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    <button class="btn btn-secondary" id="resetFilters">Reset</button>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2>Blacklisted Borrowers</h2>
                <div class="table-actions">
                    <button class="btn btn-alert" id="exportBlacklist">Export List</button>
                    <button class="btn btn-primary" id="addBlacklistBtn" disabled title="Admin only">+ Add to Blacklist</button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="data-table blacklist-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Borrower</th>
                            <th>Country</th>
                            <th>Amount</th>
                            <th>Days Overdue</th>
                            <th>Lender</th>
                            <th>Group</th>
                            <th>Blacklisted Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="blacklist-entry active">
                            <td>#BL-001</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small alert">J</div>
                                    <div class="user-info">
                                        <strong>John Doe</strong>
                                        <small>ID: GHA-123456789</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="country-cell">
                                    <img src="../assets/images/flags/gh.svg" alt="GH" class="flag-small">
                                    Ghana
                                </div>
                            </td>
                            <td>
                                <div class="amount-cell">
                                    <strong>‚Çµ5,000</strong>
                                    <small>Principal: ‚Çµ5,000</small>
                                    <small>Interest: ‚Çµ500</small>
                                    <small>Penalty: ‚Çµ6,750</small>
                                </div>
                            </td>
                            <td>
                                <span class="days-overdue">65</span>
                            </td>
                            <td>
                                <div class="lender-cell">
                                    <strong>Sarah Lender</strong>
                                    <small>Group: Family Trust</small>
                                </div>
                            </td>
                            <td>Family Trust Group</td>
                            <td>2024-03-15</td>
                            <td>
                                <span class="status-badge alert">Active</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view-details" title="View Details">üëÅÔ∏è</button>
                                    <button class="btn-action appeal" title="Appeal" disabled>‚öñÔ∏è</button>
                                    <button class="btn-action clear" title="Clear" disabled>‚úÖ</button>
                                </div>
                            </td>
                        </tr>
                        <tr class="blacklist-entry pending">
                            <td>#BL-002</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small warning">M</div>
                                    <div class="user-info">
                                        <strong>Mary Smith</strong>
                                        <small>ID: GHA-987654321</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="country-cell">
                                    <img src="../assets/images/flags/gh.svg" alt="GH" class="flag-small">
                                    Ghana
                                </div>
                            </td>
                            <td>
                                <div class="amount-cell">
                                    <strong>‚Çµ2,500</strong>
                                    <small>Principal: ‚Çµ2,500</small>
                                    <small>Interest: ‚Çµ250</small>
                                    <small>Penalty: ‚Çµ3,125</small>
                                </div>
                            </td>
                            <td>
                                <span class="days-overdue">45</span>
                            </td>
                            <td>
                                <div class="lender-cell">
                                    <strong>Mike Lender</strong>
                                    <small>Group: Church Group</small>
                                </div>
                            </td>
                            <td>Church Group</td>
                            <td>2024-03-10</td>
                            <td>
                                <span class="status-badge warning">Pending Clearance</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view-details" title="View Details">üëÅÔ∏è</button>
                                    <button class="btn-action appeal" title="Appeal">‚öñÔ∏è</button>
                                    <button class="btn-action clear" title="Clear">‚úÖ</button>
                                </div>
                            </td>
                        </tr>
                        <tr class="blacklist-entry appealed">
                            <td>#BL-003</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small">R</div>
                                    <div class="user-info">
                                        <strong>Robert Brown</strong>
                                        <small>ID: GHA-456123789</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="country-cell">
                                    <img src="../assets/images/flags/ke.svg" alt="KE" class="flag-small">
                                    Kenya
                                </div>
                            </td>
                            <td>
                                <div class="amount-cell">
                                    <strong>‚Çµ1,200</strong>
                                    <small>Principal: ‚Çµ1,200</small>
                                    <small>Interest: ‚Çµ120</small>
                                    <small>Penalty: ‚Çµ1,800</small>
                                </div>
                            </td>
                            <td>
                                <span class="days-overdue">70</span>
                            </td>
                            <td>
                                <div class="lender-cell">
                                    <strong>Anna Lender</strong>
                                    <small>Group: Business Network</small>
                                </div>
                            </td>
                            <td>Business Network</td>
                            <td>2024-03-05</td>
                            <td>
                                <span class="status-badge">Appealed</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view-details" title="View Details">üëÅÔ∏è</button>
                                    <button class="btn-action approve-appeal" title="Approve Appeal">üëç</button>
                                    <button class="btn-action reject-appeal" title="Reject Appeal">üëé</button>
                                </div>
                            </td>
                        </tr>
                        <tr class="blacklist-entry cleared">
                            <td>#BL-004</td>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-small success">D</div>
                                    <div class="user-info">
                                        <strong>David Johnson</strong>
                                        <small>ID: GHA-789456123</small>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="country-cell">
                                    <img src="../assets/images/flags/ng.svg" alt="NG" class="flag-small">
                                    Nigeria
                                </div>
                            </td>
                            <td>
                                <div class="amount-cell">
                                    <strong>‚Çµ3,000</strong>
                                    <small>Principal: ‚Çµ3,000</small>
                                    <small>Interest: ‚Çµ300</small>
                                    <small>Penalty: ‚Çµ0</small>
                                </div>
                            </td>
                            <td>
                                <span class="days-overdue">0</span>
                            </td>
                            <td>
                                <div class="lender-cell">
                                    <strong>Sarah Lender</strong>
                                    <small>Group: Family Trust</small>
                                </div>
                            </td>
                            <td>Family Trust Group</td>
                            <td>2024-02-28</td>
                            <td>
                                <span class="status-badge success">Cleared</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action view-details" title="View Details">üëÅÔ∏è</button>
                                    <button class="btn-action view-history" title="Payment History">üìä</button>
                                    <button class="btn-action reissue" title="Allow New Loans">üîÑ</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-footer">
                <div class="pagination">
                    <button class="btn-pagination prev" disabled>Previous</button>
                    <span class="page-numbers">
                        <button class="page-btn active">1</button>
                        <button class="page-btn">2</button>
                        <button class="page-btn">3</button>
                        <span>...</span>
                        <button class="page-btn">5</button>
                    </span>
                    <button class="btn-pagination next">Next</button>
                </div>
                <div class="table-summary">
                    Showing 4 of 45 blacklisted entries
                </div>
            </div>
        </div>

        <!-- Blacklist Details Modal -->
        <div id="blacklistModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Blacklist Details: #BL-001</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h3>Borrower Information</h3>
                            <div class="detail-item">
                                <span>Full Name:</span>
                                <strong>John Doe</strong>
                            </div>
                            <div class="detail-item">
                                <span>Contact:</span>
                                <strong>+233 24 123 4567</strong>
                            </div>
                            <div class="detail-item">
                                <span>National ID:</span>
                                <strong>GHA-123456789</strong>
                            </div>
                            <div class="detail-item">
                                <span>Country:</span>
                                <strong>Ghana</strong>
                            </div>
                            <div class="detail-item">
                                <span>Rating:</span>
                                <strong class="rating-bad">‚≠ê 1.2/5.0</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Loan Details</h3>
                            <div class="detail-item">
                                <span>Loan Category:</span>
                                <strong>üöå Transport</strong>
                            </div>
                            <div class="detail-item">
                                <span>Principal:</span>
                                <strong>‚Çµ5,000</strong>
                            </div>
                            <div class="detail-item">
                                <span>Interest (10%):</span>
                                <strong>‚Çµ500</strong>
                            </div>
                            <div class="detail-item">
                                <span>Penalty (5% daily):</span>
                                <strong>‚Çµ6,750</strong>
                            </div>
                            <div class="detail-item">
                                <span>Total Due:</span>
                                <strong class="amount-total">‚Çµ12,250</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Timeline</h3>
                            <div class="detail-item">
                                <span>Loan Date:</span>
                                <strong>2024-01-10</strong>
                            </div>
                            <div class="detail-item">
                                <span>Due Date:</span>
                                <strong>2024-01-17</strong>
                            </div>
                            <div class="detail-item">
                                <span>Blacklisted Date:</span>
                                <strong>2024-03-15</strong>
                            </div>
                            <div class="detail-item">
                                <span>Days Overdue:</span>
                                <strong class="days-overdue-badge">65 days</strong>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Lender & Group</h3>
                            <div class="detail-item">
                                <span>Lender:</span>
                                <strong>Sarah Lender</strong>
                            </div>
                            <div class="detail-item">
                                <span>Lender Contact:</span>
                                <strong>+233 24 987 6543</strong>
                            </div>
                            <div class="detail-item">
                                <span>Group:</span>
                                <strong>Family Trust Group</strong>
                            </div>
                            <div class="detail-item">
                                <span>Group Country:</span>
                                <strong>Ghana</strong>
                            </div>
                        </div>

                        <div class="detail-section full-width">
                            <h3>Guarantors</h3>
                            <div class="guarantors-list">
                                <div class="guarantor">
                                    <strong>James Smith</strong>
                                    <p>Contact: +233 24 111 2222</p>
                                    <p>Relationship: Friend</p>
                                </div>
                                <div class="guarantor">
                                    <strong>Sarah Johnson</strong>
                                    <p>Contact: +233 24 333 4444</p>
                                    <p>Relationship: Colleague</p>
                                </div>
                            </div>
                        </div>

                        <div class="detail-section full-width">
                            <h3>Blacklist Actions</h3>
                            <div class="action-buttons-modal">
                                <button class="btn btn-alert" id="contactCollectorBtn">Contact Debt Collector</button>
                                <button class="btn btn-warning" id="sendReminderBtn">Send Reminder</button>
                                <button class="btn btn-success" id="markClearedBtn" disabled>Mark as Cleared (Admin Only)</button>
                                <button class="btn btn-secondary" id="appealBtn">File Appeal</button>
                            </div>
                        </div>

                        <div class="detail-section full-width">
                            <h3>Payment History</h3>
                            <div class="payment-history">
                                <div class="payment-item">
                                    <span class="payment-date">2024-01-12</span>
                                    <span class="payment-amount">‚Çµ1,000</span>
                                    <span class="payment-method">M-Pesa</span>
                                    <span class="payment-status completed">Verified</span>
                                </div>
                                <div class="payment-item">
                                    <span class="payment-date">2024-01-15</span>
                                    <span class="payment-amount">‚Çµ500</span>
                                    <span class="payment-method">Cash</span>
                                    <span class="payment-status completed">Verified</span>
                                </div>
                                <div class="payment-item">
                                    <span class="payment-date">2024-03-01</span>
                                    <span class="payment-amount">‚Çµ1,500</span>
                                    <span class="payment-method">Bank Transfer</span>
                                    <span class="payment-status pending">Pending</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Pesewa.com</h3>
                <p>Emergency micro-lending in trusted circles across Africa.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="./about.html">About Us</a></li>
                    <li><a href="./contact.html">Contact</a></li>
                    <li><a href="./qa.html">Q&A</a></li>
                    <li><a href="./debt-collectors.html">Debt Collectors</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Blacklist Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Pesewa.com. All rights reserved.</p>
        </div>
    </footer>

    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/blacklist.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Filter functionality
            const applyFiltersBtn = document.getElementById('applyFilters');
            const resetFiltersBtn = document.getElementById('resetFilters');
            const searchInput = document.getElementById('searchBlacklist');
            const countryFilter = document.getElementById('countryFilter');
            const statusFilter = document.getElementById('statusFilter');
            const daysFilter = document.getElementById('daysFilter');
            const tableRows = document.querySelectorAll('.blacklist-entry');

            function filterTable() {
                const searchTerm = searchInput.value.toLowerCase();
                const countryValue = countryFilter.value;
                const statusValue = statusFilter.value;
                const daysValue = daysFilter.value;

                tableRows.forEach(row => {
                    const name = row.querySelector('.user-info strong').textContent.toLowerCase();
                    const id = row.querySelector('.user-info small').textContent.toLowerCase();
                    const country = row.querySelector('.country-cell').textContent.toLowerCase();
                    const statusClass = Array.from(row.classList).find(cls => 
                        cls !== 'blacklist-entry' && 
                        ['active', 'pending', 'appealed', 'cleared'].includes(cls)
                    );
                    const days = parseInt(row.querySelector('.days-overdue').textContent);

                    let matches = true;

                    // Search term
                    if (searchTerm && !name.includes(searchTerm) && !id.includes(searchTerm)) {
                        matches = false;
                    }

                    // Country filter
                    if (countryValue) {
                        const countryCode = row.querySelector('.flag-small').src.includes(countryValue);
                        if (!countryCode) matches = false;
                    }

                    // Status filter
                    if (statusValue) {
                        if (statusValue !== statusClass) matches = false;
                    }

                    // Days filter
                    if (daysValue && days < parseInt(daysValue)) {
                        matches = false;
                    }

                    row.style.display = matches ? '' : 'none';
                });
            }

            applyFiltersBtn.addEventListener('click', filterTable);
            resetFiltersBtn.addEventListener('click', function() {
                searchInput.value = '';
                countryFilter.value = '';
                statusFilter.value = '';
                daysFilter.value = '';
                tableRows.forEach(row => row.style.display = '');
            });

            searchInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') filterTable();
            });

            // Modal functionality
            const modal = document.getElementById('blacklistModal');
            const closeBtn = document.querySelector('.close-modal');
            const viewButtons = document.querySelectorAll('.view-details');

            viewButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    modal.style.display = 'block';
                });
            });

            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });

            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Action buttons
            document.getElementById('contactCollectorBtn').addEventListener('click', function() {
                alert('Redirecting to debt collectors page...');
                window.location.href = './debt-collectors.html';
            });

            document.getElementById('sendReminderBtn').addEventListener('click', function() {
                alert('Reminder sent to borrower and guarantors.');
            });

            document.getElementById('appealBtn').addEventListener('click', function() {
                alert('Appeal filed. An admin will review your case within 48 hours.');
            });

            // Export functionality
            document.getElementById('exportBlacklist').addEventListener('click', function() {
                alert('Blacklist exported as CSV file.');
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    window.location.href = '../index.html';
                }
            });

            // User dropdown
            const userMenuBtn = document.getElementById('userMenuBtn');
            const dropdownContent = document.querySelector('.dropdown-content');

            userMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
            });

            window.addEventListener('click', function() {
                dropdownContent.style.display = 'none';
            });
        });
    </script>
</body>
</html>